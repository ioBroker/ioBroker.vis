<link rel="stylesheet" href="lib/css/jquery-ui-timepicker-addon-1.2.2.css" />
<script type="text/javascript" src="lib/js/jquery-ui-timepicker-addon-1.2.2.js"></script>

<script type="text/javascript">
    "use strict";

    if (vis.editMode) {
        $.extend(systemDictionary, {
            "buttontext":       {"en": "Button text",       "de": "Knopftext",              "ru": "Надпись на кнопке"},
            "href":             {"en": "Link",              "de": "Link",                   "ru": "Ссылка"},
            "href_tooltip":     {"en": "Like 'http://google.com'", "de": "Wie 'http://google.com'", "ru": "Например 'http://google.com'"},
            "target":           {"en": "target",            "de": "target",                 "ru": "target"},
            "dialog_height":    {"en": "Dialog height",     "de": "Dialoghöhe",             "ru": "Высота окна"},
            "dialog_width":     {"en": "Dialog width",      "de": "Dialogbreite",           "ru": "Ширина окна"},
            "alt":              {"en": "Tooltip (alt)",     "de": "Tooltip (alt)",          "ru": "Всплывающая подсказка (alt)"},
            "text":             {"en": "Text",              "de": "Text",                   "ru": "Текст"},
            "invert_icon":      {"en": "Invert image",      "de": "Invertiere das Bild",    "ru": "Инвертировать картинку"},
            "html_dialog":      {"en": "HTML in dialog",    "de": "HTML im Dialog",         "ru": "HTML в диалоговом окне"},
            "preload":          {"en": "Prerender dialog",  "de": "Prerender Dialog",       "ru": "Рендер содержания в начале"},
            "closeOnClick":     {"en": "Close by click on dialog",  "de": "Zumachen beim Anklicken",       "ru": "Закрыть по нажатию в любом месте"},
            "preload_tooltip":  {
                "en": "If true, the content of dialog will be created at start of view.\x0AIf false, the content will be created during opening of dialog.\x0AWebcams or dynamic content require 'prerender'=false",
                "de": "Falls true, dann wird Inhalt vom Dialog sofort am Anfang gerendert.\x0AFalls false, dann beim Anzeigen vom Dialog.\x0AWebcams oder dynamischer Inhalt müssen prerender auf false haben",
                "ru": "Если да, то рендер содержания будет в самом начале.\x0AЕсли нет, то при показе диалога.\x0AWebCams или динамическое содержание требуют значение false."
            },
            "persistent":       {"en": "Persistent",        "de": "Dauernd",                "ru": "Существует постоянно"},
            "persistent_tooltip":  {
                "en": "If true, the dialog will be created at start and can\x0Abe shown by external command 'dialogOpen'.",
                "de": "Falls true, dann wird der Dialog sofort am Anfang erzeugtx0Aund mit dem Befehl 'dialogOpen' angezeigt werden konnte.",
                "ru": "Если да, то диалог будет создан в самом начале и\x0Aможет быть вызван внешней командой 'dialogOpen'."
            },
            "src_true":         {"en": "Icon by ON",         "de": "Ikon bei AN",           "ru": "Иконка при ВКЛ"},
            "alt_true":         {"en": "Tooltip by ON",      "de": "Tooltip bei AN",        "ru": "Подсказка при ВКЛ"},
            "src_false":        {"en": "Icon by OFF",        "de": "Ikon bei AUS",          "ru": "Иконка при ВЫКЛ"},
            "alt_false":        {"en": "Tooltip by OFF",     "de": "Tooltip bei AUS",       "ru": "Подсказка при ВЫКЛ"}
        });
    }

    vis.navChangeCallbacks.push(function (view) {
        $(".jqui-nav-state").each(function () {
            var $this = $(this);
            if ($this.attr("data-vis-nav") == view) {
                $this.removeClass("ui-state-default");
                $this.addClass("ui-state-active");
            } else {
                $this.addClass("ui-state-default");
                $this.removeClass("ui-state-active");
            }
        });
    });

    vis.binds.jqueryui = {
        navigationActive: function (el, nav_view) {
            var $this = $(el);
            if (window.location.hash.slice(1) == nav_view) {
                $this.removeClass("ui-state-default").addClass("ui-state-active");
            }
        },
        months: {
            "en": ['January', 'February', 'March', 'April',  'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],
            "de": ['Januar',  'Februar',  'März',  'April',  'Mai', 'Juni', 'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'],
            "ru": ['Январь',  'Февраль',  'Март',  'Апрель', 'Май', 'Июнь', 'Июль', 'Август', 'Сентябрь',  'Октябрь', 'Ноябрь',   'Декабрь']
        },
        shortMonths: {
            "en": ['Jan', 'Feb', 'Mar',  'Apr', 'May', 'Jun',  'Jul',  'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
            "de": ['Jan', 'Feb', 'Mär',  'Apr', 'Mai', 'Jun',  'Jul',  'Aug', 'Sep', 'Okt', 'Nov', 'Dez'],
            "ru": ['Янв', 'Фев', 'Март', 'Апр', 'Май', 'Июня', 'Июля', 'Авг', 'Сен', 'Окт', 'Ноя', 'Дек']
        },
        weekDays: {
            "en": ['Sunday',      'Monday',      'Tuesday',  'Wednesday', 'Thursday',   'Friday',  'Saturday'],
            "de": ['Sonntag',     'Montag',      'Dienstag', 'Mittwoch',  'Donnerstag', 'Freitag', 'Samstag'],
            "ru": ['Воскресение', 'Понедельник', 'Вторник',  'Среда',     'Четверг',    'Пятница', 'Суббота']
        },
        shortWeekDays: {
            "en": ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'],
            "de": ["So", "Mo", "Di", "Mi", "Do", "Fr", "Sa"],
            "ru": ['Вс', 'Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб']
        },
        currentText: {
            "en": 'Now',
            "de": 'Jetzt',
            "ru": 'Сейчас'
        },
        closeText: {
            "en": 'Close',
            "de": 'Schließen',
            "ru": 'Закрыть'
        },
        timeText: {
            "en": 'Time',
            "de": 'Zeit',
            "ru": 'Время'
        },
        hourText: {
            "en": 'Hour',
            "de": 'Std',
            "ru": 'Час'
        },
        minuteText: {
            "en": 'Min',
            "de": 'Min',
            "ru": 'Мин'
        },
        secondText: {
            "en": 'Sec',
            "de": 'Sek',
            "ru": 'Сек'
        },
        timeOnlyTitle: {
            "en": 'Choose Time',
            "de": 'Zeit auswählen',
            "ru": 'Установите время'
        },
        activeHelper: function ($this, val, min, max, value, reverse) {
            if (val === true  || val === 'true')  val = max;
            if (val === false || val === 'false') val = min;

            if (max === undefined || max === '' || max === null) {
                max = 1;
                min = 0;
                val = (val === 'false' || val === false || val === 0 || val === '0' || val === '' || val === null || val === undefined) ? min : max;
            }

            if (reverse) {
                if (val == max) {
                    val = min;
                } else {
                    val = max;
                }
            }

            if (value === undefined && val > min && val !== true) {
                val = parseFloat(val) || 0;
            }

            if ((value === undefined && val > min) || (value !== undefined && val == value)) {
                $this.addClass('ui-state-active');
            } else {
                $this.removeClass('ui-state-active');
            }
        },
        active: function (el, reverse, _value) {
            var $this = $(el);
            var oid = $this.data('oid');
            var max = $this.data('max') || 1;
            var min = $this.data('min') || 0;
            if (oid) {
                vis.states.bind(oid + '.val', function (e, newVal, oldVal) {
                    vis.binds.jqueryui.activeHelper($this, newVal, min, max, _value, reverse);
                });
                vis.binds.jqueryui.activeHelper($this, vis.states.attr(oid + '.val'), min, max, _value, reverse);
            }
       },
        classes: function (el, reverse, _value) {
            var $this = $(el);
            $this.hover(function () {
                $this.addClass("ui-state-hover");
            }, function () {
                $this.removeClass("ui-state-hover");
            });
            $this.css({position: 'absolute'});
            vis.binds.jqueryui.active(el, reverse, _value);
        },
        dialog: function (el, options, persistent, preload, html, closeOnClick) {
            var $dlg = $(el).parent().find('div.vis-widget-dialog');
            $dlg.data('preload', (!preload || preload == 'false') && !$dlg.html().replace(/\s/g, ''));
            $('[aria-describedby="' + $dlg.attr('id') + '"]').remove();
            // Show dialog in edit mode too
            if (1 || !vis.editMode) {
                $(el).parent().find('div.vis-widget-body').on('click touchstart', function () {
                    // Protect against two events
                    if (vis.detectBounce(this)) return;

                    if ($dlg.data('preload')) $dlg.html(html);

                    if (persistent) {
                        $dlg.dialog('open');
                    } else {
                        $dlg.dialog($.extend({
                            autoOpen: true,
                            open: function () {
                                $(this).parent().css('z-index', 998);
                            },
                            close: function () {
                                $dlg.dialog('destroy');
                                // Destroy content if not preloaded
                                if ($dlg.data('preload')) $dlg.html('');
                            }
                        }, options));

                        $dlg.data('inited', true);

                        if (closeOnClick) {
                            $dlg.unbind('click touchstart').on('click touchstart', function () {
                                $dlg.dialog('close');
                            });
                        }
                    }
                });
            }
            if (persistent) {
                $dlg.dialog($.extend({
                    autoOpen: false,
                    open: function () {
                        $dlg.parent().css({'z-index': 1000});
                        if ($dlg.data('preload')) $dlg.html(html);
                    },
                    close: function () {
                        // Destroy content if not preloaded
                        if ($dlg.data('preload')) $dlg.html('');
                    }
                }, options));

                $dlg.data('inited', true);

                if (closeOnClick) {
                    $dlg.unbind('click touchstart').on('click touchstart', function () {
                        $dlg.dialog('close');
                    });
                }
            }
        },
        dialogContainer: function (el, options, persistent, preload) {
            var dlg = $(el).parent().find("div.vis-widget-dialog");
            
            dlg.dialog($.extend({
                autoOpen: false
            }, options));
            
            if (!vis.editMode) {
                $(el).parent().find("div.vis-widget-body").on('click touchstart', function () {
                    // Protect against two events
                    if (vis.detectBounce(this)) return;

                    dlg.find("div[id$='container']").each(function () {
                        var cview = $(this).attr("data-vis-contains");
                        if (!vis.views[cview]) {
                            $(this).append("error: view not found.");
                            return false;
                        } else if (cview == vis.activeView) {
                            $(this).append("error: view container recursion.");
                            return false;
                        }
                        vis.renderView(cview, true);
                        $("#visview_" + cview).appendTo(this);
                        $("#visview_" + cview).show();

                    });

                    var id = $(this).parent().attr("id") + "_dialog";
                    $('#' + id).dialog('open');
                });
            } else {
                $(el).parent().find("div.vis-widget-body").show();
            }
        },
        dialogAutoClose: function (el) {
            var $dialog = $('#' + $(el).parent().attr('id') + '_dialog');
            // TODO auf bestimme Elemente einschränken (Button, Radio, ...)
            $dialog.on('dialogopen', function () {
                $dialog.one('click', function () {
                    $dialog.dialog("close");
                });
            });
        },
        input: function (el, options) {
            var $this  = $(el);
            var oid    = $this.attr('data-oid');
            var digits = options;
            $this.button().addClass("ui-state-default")
                    .css({
                        'font':       'inherit',
                        //'color' :   'inherit',
                        'text-align': 'left',
                        'outline':    'none',
                        'cursor':     'text',
                        height:       '50%'
                    }).change(function () {
                        vis.setValue(oid, $(this).val());
                    });
            
            vis.states.bind(oid + '.val', function (e, newVal, oldVal) {
                if (digits && digits != "") newVal = parseFloat(newVal).toFixed(digits);

                $this.val(newVal);
            });
            var val = vis.states[oid + '.val'];
            if (digits && digits != "") {
                val = parseFloat(vis.states[oid + '.val']).toFixed(digits);
            }
            $this.val(val);
        },
        inputDate: function (el, options) {
            var $this = $(el);
            var oid = $this.attr('data-oid');
            var datepickerOptions = $.extend(true, {
                dateFormat:      'yy-mm-dd',
                monthNamesShort: vis.binds.jqueryui.shortMonths[vis.language],
                monthNames:      vis.binds.jqueryui.months[vis.language],
                dayNamesMin:     vis.binds.jqueryui.shortWeekDays[vis.language],
                showAnim:        "fadeIn",
                firstDay: 1,
                currentText:     vis.binds.jqueryui.currentText[vis.language],
                closeText:       vis.binds.jqueryui.closeText[vis.language]

            }, options);

            $this.addClass("ui-widget ui-button ui-corner-all ui-state-default")
                .css({
                    font:       'inherit',
                    //'color' :   'inherit',
                    'text-align': 'left',
                    outline:    'none',
                    cursor:     'text',
                    height:     '95%'
                });
            
            if (!vis.editMode) $this.datepicker(datepickerOptions);

            $this.change(function () {
                vis.setValue(oid, $(this).val());
            });
            vis.states.bind(oid + '.val', function (e, newVal, oldVal) {
                $this.val(newVal);
            });
            $this.val(vis.states.attr(oid + '.val'));
        },
        inputDatetime: function (el, options) {
            var $this = $(el);
            var oid = $this.attr('data-oid');
            var timepickerOptions = $.extend(true, {
                dateFormat:      'yy-mm-dd',
                monthNamesShort: vis.binds.jqueryui.shortMonths[vis.language],
                monthNames:      vis.binds.jqueryui.months[vis.language],
                dayNamesMin:     vis.binds.jqueryui.shortWeekDays[vis.language],
                showAnim:        'fadeIn',
                firstDay:        1,
                timeText:        vis.binds.jqueryui.timeText[vis.language],
                hourText:        vis.binds.jqueryui.hourText[vis.language],
                minuteText:      vis.binds.jqueryui.minuteText[vis.language],
                secondText:      vis.binds.jqueryui.secondText[vis.language],
                currentText:     vis.binds.jqueryui.currentText[vis.language],
                closeText:       vis.binds.jqueryui.closeText[vis.language],
                timeOnlyTitle:   vis.binds.jqueryui.timeOnlyTitle[vis.language],
                minuteGrid:      undefined,
                hourGrid:        undefined,
                secondGrid:      undefined,
                timeOnly:        false,
                showSecond:      true,
                timeFormat:      'HH:mm:ss',
                pickerTimeFormat: 'HH:mm:ss'
            }, options);
            $this.addClass("ui-state-default")
            .css({
                'font':       'inherit',
                //'color':    'inherit',
                'text-align': 'left',
                'outline':    'none',
                'cursor':     'text',
                height:       '95%'
            });
            // Store options
            $this[0].__options = options;

            if (!vis.editMode) {
                $this.datetimepicker(timepickerOptions).button();
            } else {
                $this.addClass("ui-widget ui-button ui-corner-all");
            }
            $this.change(function () {
                var $this = $(this);
                var val = $this.val();
                /*if ($this[0].__options && !$this[0].__options.showSecond) {
                    var vals = val.split(':');
                    if (vals.length == 3) {
                        val = vals[0] + ":" + vals[1];
                    }
                }*/
                vis.setValue(oid, val);
            });
            vis.states.bind(oid + '.val', function (e, newVal, oldVal) {
                $this.val(newVal);
            });
            $this.val(vis.states.attr(oid + '.val'));
        },
        inputset: function (el, options) {
            var digits = options;
            var $this = $(el);
            var input = '#' + $this.attr("id").slice(0, -3) + 'input';

            var oid = $this.attr('data-oid');

            if (!vis.editMode) {
                $this.button().on('click touchstart', function () {
                    // Protect against two events
                    if (vis.detectBounce(this)) return;

                    vis.setValue(oid,  $(input).val());
                });
            }
            $this.prev().button().addClass("ui-state-default")
                    .css({
                        'font':       'inherit',
                        //'color' :   'inherit',
                        'text-align': 'left',
                        'outline':    'none',
                        'cursor':     'text',
                        height:       '95%'
                    });
            vis.states.bind(oid + '.val', function (e, newVal, oldVal) {
                if (digits && digits != '') {
                    newVal = parseFloat(newVal).toFixed(digits);
                }
                $(input).val(newVal);

            });
            var newVal = vis.states[oid + '.val'];
            if (digits && digits != '') newVal = parseFloat(newVal).toFixed(digits);
            $(input).val(newVal);
        },
        multiselect: function (el, options, isOpen) {
            var $this = $(el);
            var oid = $this.attr('data-oid');
            $this.find('option:selected').removeAttr('selected');
            $this.find('option[value="' + vis.states[oid + '.val'] + '"]').attr('selected', true);

            $this.multiselect($.extend({
                minWidth:         $this.parent().parent().width() - 7,
                multiple:         false,
                header:           false,
                noneSelectedText: false,
                selectedList:     1
            }, options)).change(function () {
                if (!vis.editMode) vis.setValue(oid, $this.find('option:selected').val());
            });

            $this.find('option:selected').removeAttr('selected');
            $this.find("option[value='" + vis.states[oid + '.val'] + "']").attr('selected', true);
            $this.prop("disabled", vis.editMode);
            $this.multiselect('refresh');

            vis.states.bind(oid + '.val', function (e, newVal, oldVal) {
                $this.find('option:selected').removeAttr('selected');
                $this.find('option[value="' + newVal + '"]').attr('selected', true);
                $this.multiselect('refresh');
            });
            
            if (vis.editMode) {
                if (isOpen) $this.multiselect('open');
                
                vis.bindWidgetClick(el.id);
                $this.parent().parent().resize(function () {
                    $this.multiselect('option', 'minWidth', $(this).width() - 7);
                });
            }
        },
        slider: function (el, options) {
            var $this = $(el);
            var oid = $this.attr('data-oid');
            var wid = $this.attr("data-oid-working");
            var settings = $.extend({
                min:   0,
                max:   100,
                step:  1,
                value: parseFloat(vis.states.attr(oid + '.val')),
                slide: function (e, ui) {0
                    // Slider -> Observable
                    if (options.inverted) ui.value = (settings.max - ui.value) + settings.min;
                    vis.setValue(oid, ui.value); //.toFixed(6));
                }
            }, options);

            settings.inverted = (settings.inverted === 'true' || settings.inverted === true);

            if (isNaN(settings.value)) settings.value = 0;
            if (isNaN(settings.min))   settings.min   = 0;
            if (isNaN(settings.max))   settings.max   = 100;
            if (isNaN(settings.step))  settings.step  = (settings.max - settings.min) / 100;

            settings.min   = parseFloat(settings.min);
            settings.max   = parseFloat(settings.max);
            settings.value = parseFloat(settings.value);

            if (settings.inverted) settings.value = (settings.max - settings.value) + settings.min;

            $this.slider(settings);

            vis.states.bind(oid + '.val', function (e, newVal, oldVal) {
               // console.log("slider newVal="+JSON.stringify(newVal));
                // If device not in working state
                if (!vis.states.attr(wid + '.val')) {
                    var value = parseFloat(newVal);
                    if (settings.inverted) value = (settings.max - value) + settings.min;
                    if ($this.slider('instance')) {
                        $this.slider('value', value);
                    }
                }
            });
        },
        button: function (el, value) {
            $(el).button();
        },
        buttonDialog: function (el) {
            $(el).button();
        },
        buttonLink: function (el, href) {
            $(el).button().click(function () {
                if (!vis.editMode && href) window.location.href = href;
            });
        },
        buttonLinkBlank: function (el, href) {
            $(el).button().click(function () {
                if (!vis.editMode && href) window.open(href);
            });
        },
        radio: function (el, options, process) {
            if (!process) {
                setTimeout(function () {
                    vis.binds.jqueryui.radio(el, process, true);
                }, 50);
                return;
            }
            var settings = $.extend({}, options);
            var $this = $(el);
            var oid = $this.attr('data-oid');

            // Observable -> Buttonset
            vis.states.bind(oid + '.val', function (e, newVal, oldVal) {
                $this.find('input').removeAttr('checked');
                if (newVal === true || newVal === 'true') {
                    newVal = 1;
                } else
                if (newVal === false || newVal === 'false') {
                    newVal = 0;
                }

                $this.find('input[value="' + newVal + '"]').prop('checked', true);
                $this.find('input').each(function () {
                    if ($(this).button('instance')) $(this).button('refresh');
                });
            });

            var val = vis.states.attr(oid + '.val');

            if (val === true  || val === 'true')  { val = 1; }
            if (val === false || val === 'false') { val = 0; }
            setTimeout(function () {
                //console.log(val + ' ' + $this.find('input[value="' + val + '"]').length);
                $this.find('input').removeAttr('checked');
                $this.find('input[value="' + val + '"]').prop('checked', true);
                $this.buttonset(settings);

                $this.find('input').each(function () {
                     if ($this.button('instance')) $(this).button('refresh');
                });
                if (!vis.editMode) {
                    // Buttonset -> Observable
                    $this.find('input').on('click touchstart', function () {
                        // Protect against two events
                        if (vis.detectBounce(this)) return;

                        var val = $(this).val();
                        var f = parseFloat(val);
                        if (f.toString() == val.toString()) {
                            vis.setValue(oid, f);
                        } else {
                            vis.setValue(oid, val);
                        }
                    });
                }
            }, 50);
        },
        iconHttpGet: function (el, url) {
            if (vis.editMode) return;
            
            var $this = $(el).parent();
            $this.on('click touchstart', function (e) {
                // Protect against two events
                if (vis.detectBounce(this)) return;

                vis.conn.httpGet(url);
                e.preventDefault();
            });
        },
        hueColormode: function (el, oid) {
            var $hue = $(el).parent().find('.hue-mode-hue');
            var $ct  = $(el).parent().find('.hue-mode-ct');

            if (vis.states.attr(oid + '.val') == 'ct') {
                $hue.hide();
                $ct.show();
            } else {
                $ct.hide();
                $hue.show();
            }

            vis.states.bind(oid + '.val', function (e, newVal, oldVal) {
                if (newVal == 'ct') {
                    $hue.hide();
                    $ct.show();
                } else {
                    $ct.hide();
                    $hue.show();
                }
            });
        },
        
        _disable: function () {
            $("div#vis_container").find(".ui-slider").each(function () {
                if ($(this).slider('instance')) {
                    $(this).slider('disable').removeClass("ui-state-disabled");
                }
            });

            setTimeout(function () {
                $("div#vis_container").find("select[id$='_multiselect']").each(function () {
                    if ($(this).css("display") == "none") {
                        $(this).multiselect('disable').next().removeClass("ui-state-disabled").unbind('click touchstart', false);
                    }
                });
            }, 200);
            setTimeout(function () {
                $("div#vis_container").find("a[href]").each(function () {
                    $(this).on('click touchstart', function (e) {});
                });
            }, 200);
        },

        itoggle: function (el){
            var $this = $(el).parent();
            var oid = $this.parent().attr('data-oid') + '.val';
            var val = vis.states.attr(oid);

            if (val === 'false') {
                val = false;
            } else if (val === 'true') {
                val = true;
            } else if (typeof val == "string") {
                var f = parseFloat(val);
                if (f == val) {
                    val = f;
                } else if (val !== '') {
                    val = true;
                } else {
                    val = false;
                }
            }
            if (val > 0) {
                $this.find(".imgToggleFalse").hide();
                $this.find(".imgToggleTrue").show();
            }
            vis.states.bind(oid, function (e, val) {
                if (val === true || val === 'true' || parseFloat(val) > 0) {
                    $this.find(".imgToggleFalse").hide();
                    $this.find(".imgToggleTrue").show();
                } else {
                    $this.find(".imgToggleTrue").hide();
                    $this.find(".imgToggleFalse").show();
                }
            });
        },
        calcValue: function (value, min, max) {
            if (!min) min = 0;
            if (max === null || max === undefined || max === '') max = 100;
            min = parseFloat(min);
            max = parseFloat(max);
            value = parseFloat(value);
            return min + value * (max - min);
        },
        calcImage: function (val, min, max, invert) {
            var max = (max !== undefined) ? max : 100;
            var min = (min !== undefined) ? min : 0;

            val = parseFloat(val);
            if (invert) val = max - val + min;
            var image = '';
            if (val >= max) {
                image = 10;
            } else if (val >= min + (max - min) * 0.9) {
                image = 9;
            } else if (val >= min + (max - min) * 0.8) {
                image = 8;
            } else if (val >= min + (max - min) * 0.7) {
                image = 7;
            } else if (val >= min + (max - min) * 0.6) {
                image = 6;
            } else if (val >= min + (max - min) * 0.5) {
                image = 5;
            } else if (val >= min + (max - min) * 0.4) {
                image = 4;
            } else if (val >= min + (max - min) * 0.3) {
                image = 3;
            } else if (val >= min + (max - min) * 0.2) {
                image = 2;
            } else if (val >= min + (max - min) * 0.1) {
                image = 1;
            } else {
                image = 0;
            }
            return image;
        },
        setSvgColor: function (el, color) {
            setTimeout(function () {
                el.parent().find('svg').remove();
                var $that = el;
                var imgURL = $that.attr('src');
                $.get(imgURL, function(data) {
                    // Get the SVG tag, ignore the rest
                    var $svg = jQuery(data).find('svg');

                    // Remove any invalid XML tags as per http://validator.w3.org
                    $svg = $svg.removeAttr('xmlns:a');
                    $svg = $svg.attr('width',  '100%');
                    $svg = $svg.attr('height', '100%');
                    $svg.find('*').each(function () {
                        var style = $(this).attr('style');
                        if (style) {
                            style = style.replace(/#FFFFFF/g, color);
                            $(this).attr('style', style);
                        }
                    });

                    // Replace image with new SVG
                    $that.replaceWith($svg);

                    }, 'xml');
                console.log('SVG');
            }, 0);
        }
    };
</script>

<script id="tplJquiButtonLink" 
        type="text/ejs" 
        class="vis-tpl"
        data-vis-prev='<div id="prev_tplJquiButtonLink" style=" position: relative; text-align: initial;"><div class="vis-widget_prev ui-selectee ui-selected" style="height: 30px"> <div class="vis-widget-prev-body"> <input type="button" value=" Button " class="ui-button ui-widget ui-state-default ui-corner-all" role="button"> </div> </div>'
        data-vis-set="jqui"
        data-vis-type="static"
        data-vis-name="Button Link"
        data-vis-attrs="buttontext[Text];href;html_prepend;html_append;padding[5]/slider,0,100,1">
    <div class="vis-widget <%== this.data.attr('class') %>" id="<%= this.data.attr('wid') %>" data-vis-resizable='{"disabled":true, "handles":"e"}' >
        <div class="vis-widget-body" >
            <%== this.data.attr("html_prepend") %>
            <input type="button" id="<%= this.data.attr('wid') %>_button" name="<%= this.data.attr('wid') %>_button" value="<%= this.data.attr('buttontext') %>" data-vis-link="<%= this.data.attr('value') %>" <%= (el) -> vis.binds.jqueryui.buttonLink(el, data.attr('href')); %> style="padding: <%= this.data.attr('padding') %>px"/>
            <%== this.data.attr("html_append") %>
        </div>
    </div>
</script>

<script id="tplJquiButtonLinkBlank" 
        type="text/ejs" 
        class="vis-tpl"
        data-vis-prev='<div id="prev_tplJquiButtonLinkBlank" style=" position: relative; text-align: initial;padding: 4px;height: 30px"><div  style="height: 30px" class="vis-widget_prev ui-selectee ui-selected ui-draggable-handle" data-vis-resizable="{"disabled":true, "handles":"e"}"> <div class="vis-widget-prev-body"> <input type="button" value=" Link " data-vis-link="" class="ui-button ui-widget ui-state-default ui-corner-all" role="button"> </div> </div>'
        data-vis-set="jqui"
        data-vis-type="static"
        data-vis-name="Button Link _blank"
        data-vis-attrs="buttontext[Text];href;html_prepend;html_append;padding[5]/slider,0,100,1">
    <div class="vis-widget <%== this.data.attr('class') %>" id="<%= this.data.attr('wid') %>" data-vis-resizable='{"disabled":true, "handles":"e"}' >
        <div class="vis-widget-body" >
            <%== this.data.attr("html_prepend") %>
            <input type="button" id="<%= this.data.attr('wid') %>_button" name="<%= this.data.attr('wid') %>_button" value="<%= this.data.attr('buttontext') %>" data-vis-link="<%= this.data.attr('value') %>" <%= (el) -> vis.binds.jqueryui.buttonLinkBlank(el, data.attr('href')); %> style="padding: <%= this.data.attr('padding') %>px"/>
            <%== this.data.attr("html_append") %>
        </div>
    </div>
</script>

<script id="tplIconLink" 
        type="text/ejs" 
        class="vis-tpl"
        data-vis-set="jqui"
        data-vis-type="static"
        data-vis-name="Icon link"
        data-vis-attrs="src/image;href;target/auto,,_blank,_self,_parent,_top;alt;text;invert_icon/checkbox">
    <%
    var styles = "";
    if (this.data.invert_icon === 'true' || this.data.invert_icon === true) {
        styles = "filter: invert(1); -webkit-filter: invert(1); -moz-filter: invert(1); -o-filter: invert(1); -ms-filter: invert(1);";
    }
    %>
    <div class="vis-widget ui-widget ui-button ui-corner-all ui-state-default <%== this.data.attr('class') %>" style="width: 76px; height: 32px;" id="<%= this.data.attr('wid') %>" <%= (el) -> vis.binds.jqueryui.classes(el) %>>
        <div class="vis-widget-body">
            <a class="widget-link" href="<%== this.data.attr('href') %>" target="<%== this.data.attr('target') %>" style="white-space:no-wrap; text-decoration: none; text-align: left; width:100%;height:100%;">
                <img <%= this.data.attr('src') ? 'src="' +  this.data.attr('src') + '"' : '' %> style="<%= styles %> vertical-align: middle; height: 100%;" alt="<%== this.data.attr('alt') %>" />
                <%= this.data.attr('text') %>
            </a>
        </div>
    </div>
</script>

<script id="tplIconHttpGet" 
        type="text/ejs" 
        class="vis-tpl" 
        data-vis-set="jqui"
        data-vis-type="static"
        data-vis-name="Icon HTTP GET"
        data-vis-attrs="url;src;alt;text">
    <%
    var styles = "";
    if (this.data.invert_icon === 'true' || this.data.invert_icon === true) {
    styles = "filter: invert(1); -webkit-filter: invert(1); -moz-filter: invert(1); -o-filter: invert(1); -ms-filter: invert(1);";
    }
    %>
    <div class="vis-widget ui-widget ui-button ui-corner-all ui-state-default <%== this.data.attr('class') %>" style="width: 76px; height: 76px;" id="<%= this.data.attr('wid') %>" <%= (el) -> vis.binds.jqueryui.classes(el) %>>
        <div class="vis-widget-body">
            <a class="widget-link" href='#' style="white-space:no-wrap; text-decoration:none;text-align:left;width:100%;height:100%;"><img <%= this.data.attr('src') ? 'src="' +  this.data.attr('src') + '"' : '' %> style="<%= styles %> vertical-align:middle;height:100%;" alt="<%== this.data.attr('alt') %>" /><%= this.data.attr('text') %></a>
            <div <%= (el) -> vis.binds.jqueryui.iconHttpGet(el, data.attr('url')) %> />
        </div>
    </div>
</script>

<script id="tplJquiDialog" 
        type="text/ejs" 
        class="vis-tpl" 
        data-vis-set="jqui"
        data-vis-type="static,dialog"
        data-vis-name="HTML - Dialog"
        data-vis-attrs="html/text;"
        data-vis-attrs0="group.dialog;html_dialog/text;title;modal/checkbox;dialog_width;dialog_height;persistent/checkbox;preload/checkbox;closeOnClick/checkbox">

    <div class="vis-widget <%== this.data.attr('class') %>" style="width: 200px; height: 130px; border: 1px solid #000; background: #fff;" id="<%= this.data.attr('wid') %>">
        <div id="<%= this.data.attr('wid') %>_body" class="vis-widget-body">
            <%== this.data.attr("html") %>
        </div>
        <div id="<%= this.data.attr('wid') %>_dialog" class="vis-widget-dialog" title="<%= this.data.attr('title') %>">
            <%== this.data.attr("preload") ? this.data.attr("html_dialog") : "" %>
        </div>
        <div class="popup-helper" <%= (el) -> vis.binds.jqueryui.dialog(el, {width: data.attr('dialog_width'), height: data.attr('dialog_height'), modal: data.attr('modal')}, data.attr('persistent'), data.attr('preload'), data.attr('html_dialog'), data.attr('closeOnClick')) %> />
    </div>
</script>

<script id="tplJquiIconDialog" 
        type="text/ejs" 
        class="vis-tpl" 
        data-vis-set="jqui"
        data-vis-type="static,dialog"
        data-vis-name="static - Icon - Dialog"
        data-vis-attrs="src/image;alt;text;invert_icon/checkbox;"
        data-vis-attrs0="group.dialog;html_dialog/text;title;modal/checkbox;dialog_width;dialog_height;persistent/checkbox;preload/checkbox;closeOnClick/checkbox">
    <%
    var styles = "";
    if (this.data.invert_icon === 'true' || this.data.invert_icon === true) {
        styles = "filter: invert(1); -webkit-filter: invert(1); -moz-filter: invert(1); -o-filter: invert(1); -ms-filter: invert(1);";
    }
    %>
    <div class="vis-widget ui-widget ui-button ui-corner-all ui-state-default <%== this.data.attr('class') %>" style="width: 76px; height: 76px;" id="<%= this.data.attr('wid') %>" <%= (el) -> vis.binds.jqueryui.classes(el) %>>
        <div id="<%= this.data.attr('wid') %>_body" class="vis-widget-body">
            <img <%= this.data.attr('src') ? 'src="' +  this.data.attr('src') + '"' : '' %> style="<%= styles %> vertical-align: middle; height:100%;" alt="<%== this.data.attr('alt') %>" /><%= this.data.attr('text') %>
        </div>
        <div id="<%= this.data.attr('wid') %>_dialog" class="vis-widget-dialog" title="<%= this.data.attr('title') %>">
            <%== this.data.attr("preload") ? this.data.attr("html_dialog") : "" %>
        </div>
        <div class="popup-helper" <%= (el) -> vis.binds.jqueryui.dialog(el, {width: data.attr('dialog_width'), height: data.attr('dialog_height'), modal: data.attr('modal')}, data.attr('persistent'), data.attr('preload'), data.attr('html_dialog'), data.attr('closeOnClick')) %> />
    </div>
</script>

<script id="tplContainerDialog" 
        type="text/ejs" 
        class="vis-tpl" 
        data-vis-set="jqui" 
        data-vis-name="container - HTML - view in jqui Dialog" 
        data-vis-attrs="html/text;contains_view;"
        data-vis-attrs0="group.dialog;title;modal/checkbox;dialog_width;dialog_height">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width: 200px; height: 130px; border: 1px solid #000; background: #fff;" id="<%= this.data.attr('wid') %>">
        <div id="<%= this.data.attr('wid') %>_body" class="vis-widget-body">
            <%== this.data.attr("html") %>
        </div>
        <div id="<%= this.data.attr('wid') %>_dialog" style="display:none" class="vis-widget-dialog" title="<%= this.data.attr('title') %>">
            <div id="<%= this.data.attr('wid') %>_container" data-vis-contains="<%= this.data.attr('contains_view') %>" class="vis-widget-body">
            </div>
        </div>
        <div class="popup-helper" <%= (el) -> vis.binds.jqueryui.dialogContainer(el, {width: data.attr('dialog_width'), height: data.attr('dialog_height'), modal: data.attr('modal')}) %> />
    </div>
</script>

<script id="tplContainerDialogExternal" 
        type="text/ejs" 
        class="vis-tpl" 
        data-vis-set="jqui" 
        data-vis-name="container - ext cmd - view in jqui Dialog" 
        data-vis-attrs="html/text;contains_view/view;"
        data-vis-attrs0="group.dialog;title;modal/checkbox;dialog_width;dialog_height">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width: 194px; height: 68px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body" style="display:none; width: 190px; height: 64px; background-color: #333; color: #eee; border: 2px dashed red; opacity:0.8;">
            <b>External Container Dialog</b><br/>
            view: <%= this.data.attr('contains_view') %><br/>
            id: <%= this.data.attr('wid') %>
        </div>
        <div id="<%= this.data.attr('wid') %>_dialog" style="display:none" class="vis-widget-dialog" title="<%= this.data.attr('title') %>">
            <div id="<%= this.data.attr('wid') %>_container" data-vis-contains="<%= this.data.attr('contains_view') %>" class="vis-widget-body">
            </div>
        </div>
        <div class="popup-helper" <%= (el) -> vis.binds.jqueryui.dialogContainer(el, {width: data.attr('dialog_width'), height: data.attr('dialog_height'), modal: data.attr('modal')}) %> />
    </div>
</script>

<script id="tplContainerIconDialog" 
        type="text/ejs"
        class="vis-tpl" 
        data-vis-set="jqui" 
        data-vis-name="container - Icon - view in jqui Dialog" 
        data-vis-attrs="src/image;alt;text;"
        data-vis-attrs0="group.dialog;contains_view/view;title;modal/checkbox;dialog_width;dialog_height;invert_icon/checkbox">
    <%
    var styles = "";
    if (this.data.invert_icon === 'true' || this.data.invert_icon === true) {
        styles = "filter: invert(1); -webkit-filter: invert(1); -moz-filter: invert(1); -o-filter: invert(1); -ms-filter: invert(1);";
    }
    %>

    <div class="vis-widget ui-widget ui-button ui-corner-all ui-state-default <%== this.data.attr('class') %>" style="width: 76px; height: 76px;" id="<%= this.data.attr('wid') %>" <%= (el) -> vis.binds.jqueryui.classes(el) %>>
        <div id="<%= this.data.attr('wid') %>_body" class="vis-widget-body">
            <img <%= this.data.attr('src') ? 'src="' +  this.data.attr('src') + '"' : '' %> style="<%= styles %> vertical-align:middle;height:100%;" alt="<%== this.data.attr('alt') %>" /><%= this.data.attr('text') %>
        </div>
        <div id="<%= this.data.attr('wid') %>_dialog" style="display:none" class="vis-widget-dialog" title="<%= this.data.attr('title') %>">
            <div id="<%= this.data.attr('wid') %>_container" data-vis-contains="<%= this.data.attr('contains_view') %>" class="vis-widget-body"></div>
        </div>
        <div class="popup-helper" <%= (el) -> vis.binds.jqueryui.dialogContainer(el, {width: data.attr('dialog_width'), height: data.attr('dialog_height'), modal: data.attr('modal')}) %> />
    </div>
</script>

<script id="tplContainerButtonDialog" 
        type="text/ejs"
        class="vis-tpl" 
        data-vis-set="jqui" 
        data-vis-name="container - Button - view in jqui Dialog"
        data-vis-attrs="html_prepend/text;html_append/text;buttontext[Text];"
        data-vis-attrs0="group.dialog;contains_view/view;title;modal/checkbox;dialog_width;dialog_height;padding[5]/slider,0,100,1">
    <div class="vis-widget <%== this.data.attr('class') %>" id="<%= this.data.attr('wid') %>">
        <div id="<%= this.data.attr('wid') %>_body" class="vis-widget-body">
            <%== this.data.attr("html_prepend") %>
            <input type="button" id="<%= this.data.attr('wid') %>_button" name="<%= this.data.attr('wid') %>_button" value="<%= this.data.attr('buttontext') %>" data-oid="<%= this.data.attr('oid') %>" data-val="<%= this.data.attr('value') %>" <%= (el) -> vis.binds.jqueryui.buttonDialog(el); %> style="padding: <%= this.data.attr('padding') %>px"/>
            <%== this.data.attr("html_append") %>
        </div>
        <div id="<%= this.data.attr('wid') %>_dialog" style="display:none" class="vis-widget-dialog" title="<%= this.data.attr('title') %>">
            <div id="<%= this.data.attr('wid') %>_container" data-vis-contains="<%= this.data.attr('contains_view') %>" class="vis-widget-body"></div>
        </div>
        <div class="popup-helper" <%= (el) -> vis.binds.jqueryui.dialogContainer(el, {width:data.attr('dialog_width'), height: data.attr('dialog_height'), modal: data.attr('modal')}) %> />
    </div>
</script>

<script id="tplJquiButtonNav" 
        type="text/ejs" 
        class="vis-tpl"
        data-vis-prev='<div id="prev_tplJquiButtonNav" style=" position: relative; text-align: initial;padding: 4px;height: 30px"><div class="vis-widget_prev ui-selectee ui-draggable-handle " style="left: 167px; top: 129px;" > <div class="vis-widget-prev-body"> <input type="button" value=" Nav Button " class="ui-button ui-widget ui-state-default ui-corner-all" role="button"> </div> '
        data-vis-set="jqui"
        data-vis-type="navigation"
        data-vis-name="Button"
        data-vis-attrs="html_prepend;html_append;buttontext[Text];nav_view;hide_effect;hide_duration;show_effect;show_duration">
    <div class="vis-widget <%== this.data.attr('class') %>" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <%== this.data.attr("html_prepend") %>
            <input type="button" id="<%= this.data.attr('wid') %>_button" name="<%= this.data.attr('wid') %>_button" value="<%= this.data.attr('buttontext') %>" <%= (el) -> jQuery(el).button(); vis.binds.jqueryui.navigationActive(el, data.attr('nav_view')); vis.binds.basic.navigation(el, {nav_view:data.attr('nav_view'),hideOptions:{effect:data.attr('hide_effect'),options:{},duration:data.attr('hide_duration')},showOptions:{effect:data.attr('show_effect'),options:{},duration:data.attr('show_duration')}}) %> />
            <%== this.data.attr("html_append") %>
        </div>
    </div>
</script>

<script id="tplJquiIconNav" 
        type="text/ejs" 
        class="vis-tpl" 
        data-vis-set="jqui" 
        data-vis-name="navigation - Icon" 
        data-vis-attrs="src/image;alt;text;nav_view;hide_effect;hide_duration;show_effect;show_duration">
    <div data-vis-nav="<%= this.data.attr('nav_view') %>" class="vis-widget ui-widget ui-button ui-corner-all ui-state-default jqui-nav-state <%== this.data.attr('class') %>" style="width: 76px; height: 76px;" id="<%= this.data.attr('wid') %>" <%= (el) -> vis.binds.jqueryui.classes(el); vis.binds.jqueryui.navigationActive(el, data.attr('nav_view')); vis.binds.basic.navigation(el, {nav_view: data.attr('nav_view'), hideOptions: {effect: data.attr('hide_effect'), options: {}, duration: data.attr('hide_duration')}, showOptions: {effect: data.attr('show_effect'), options: {}, duration: data.attr('show_duration')}}) %>>
        <div class="vis-widget-body">
            <img <%= this.data.attr('src') ? 'src="' +  this.data.attr('src') + '"' : '' %> style="vertical-align:middle;height:100%;" alt="<%== this.data.attr('alt') %>" /><%= this.data.attr('text') %>

        </div>
    </div>
</script>

<script id="tplJquiInput" 
        type="text/ejs" 
        class="vis-tpl"
        data-vis-prev='<div id="prev_tplJquiInput" style=" position: relative; text-align: initial;padding: 4px "><div class="vis-widget_prev ui-selectee ui-draggable-handle " style="top: 445px; left: 314px; width: 116px; height: 30px;" > <div class="vis-widget-prev-body" style="text-align: center"> <label style=" display: none;">Input</label><input type="text" value=" Input" size="10" data-o class="ui-button ui-widget ui-state-default ui-corner-all" role="button" style="font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; line-height: inherit; text-align: left; outline: none; cursor: text;"> </div> '
        data-vis-set="jqui" 
        data-vis-type="ctrl"
        data-vis-name="Input"
        data-vis-attrs="label[Input];oid;digits[0]/slider,0,10,1;size[10]/slider,10,100,1">
    <div class="vis-widget <%== this.data.attr('class') %>" style="top:0px;left:0px;width:275px;height:44px;" id="<%= this.data.attr("wid") %>">
        <div class="vis-widget-body">
            <label for="<%= this.data.attr('wid') %>_input"><%= ((this.data.attr('label') === undefined || this.data.attr('label') === null) ? '' : this.data.attr('label')) %></label>
            <input type="text" name="<%= this.data.attr('wid') %>_input" id="<%= this.data.attr('wid') %>_input" value="" size="<%= this.data.attr('size') %>" data-oid="<%= this.data.attr('oid') %>" <%= (el) -> vis.binds.jqueryui.input(el, data.digits); %> />
        </div>
    </div>
</script>

<script id="tplJquiBool"
        type="text/ejs" 
        class="vis-tpl" 
        data-vis-set="jqui"
        data-vis-type="ctrl"
        data-vis-name="Icon Bool"
        data-vis-attrs="oid;html_true;html_false">

    <div class="ui-widget ui-corner-all ui-state-default vis-widget <%== this.data.attr('class') %>" style="width:76px; height:76px" id="<%= this.data.attr('wid') %>"  data-oid="<%= this.data.attr('oid') %>" <%= (el) -> vis.binds.basic.toggle(el); vis.binds.jqueryui.classes(el) %>>
    <div class="vis-widget-body">
        <div>
            <%
            var str = vis.states.attr(this.data.oid + '.val');
            var val = parseFloat(str);
            var state;
            if (str === false || str === 'false' || val == 0) {
            %>
            <%== this.data.attr("html_false") %>
            <% } else { %>
            <%== this.data.attr("html_true") %>
            <% } %>


        </div>
    </div>
    </div>
</script>

<script id="tplJquiToogle" 
        type="text/ejs" 
        class="vis-tpl"
        data-vis-prev='<div id="prev_tplJquiToogle" style="position: relative; text-align: initial;padding: 4px "><div class="ui-widget ui-corner-all ui-state-default vis-widget_prev" style="width: 90px; height: 19px; padding: 10px;"> <div class="vis-widget-prev-body"><label>Toggle Icon</label><img class="imgToggleFalse" src="/vis/icon/add.png" style=" vertical-align:middle; height:100%"></div></div></div>'
        data-vis-set="jqui"
        data-vis-type="ctrl,state"
        data-vis-name="Icon Toggle"
        data-vis-attrs="label;oid;src_true/image;alt_true;src_false/image;alt_false;invert_icon/checkbox">

    <div class="ui-widget ui-corner-all ui-state-default vis-widget <%== this.data.attr('class') %>" style="width:76px; height:76px" id="<%= this.data.attr('wid') %>"  data-oid="<%= this.data.attr('oid') %>" <%= (el) -> vis.binds.basic.toggle(el); vis.binds.jqueryui.classes(el) %>>
        <div class="vis-widget-body">
            <%
            var styles = "";
            if (this.data.invert_icon === 'true' || this.data.invert_icon === true) {
                styles = "filter: invert(1); -webkit-filter: invert(1); -moz-filter: invert(1); -o-filter: invert(1); -ms-filter: invert(1);";
            }
            %>
            <label for="<%= this.data.attr('wid') %>_input"><%== this.data.attr('label') %></label>
            <img class="imgToggleFalse" <%= this.data.attr('src_false') ? 'src="' +  this.data.attr('src_false') + '"' : '' %> style="<%= styles %> vertical-align:middle; height:100%"               alt="<%== this.data.attr('alt_false') %>" />
            <img class="imgToggleTrue"  <%= this.data.attr('src_true')  ? 'src="' +  this.data.attr('src_true')  + '"' : '' %> style="<%= styles %> vertical-align:middle; height:100%; display:none" alt="<%== this.data.attr('alt_true')  %>" />
            <div <%= (el) -> vis.binds.jqueryui.itoggle(el) %>></div>
        </div>
    </div>
</script>

<script id="tplJquiInputDate" 
        type="text/ejs" 
        class="vis-tpl" 
        data-vis-set="jqui"
        data-vis-name="ctrl - Input Date" 
        data-vis-attrs="oid;size[10]/slider,1,50,1">
    <div class="vis-widget <%== this.data.attr('class') %>" style="top:0px;left:0px;width:200px;height:40px;" id="<%= this.data.attr("wid") %>">
        <% if (vis.editMode) { %>
			<div class="editmode-helper" />
		<% } %>
        <div class="vis-widget-body">
            <input type="text" name="<%= this.data.attr('wid') %>_input" id="<%= this.data.attr('wid') %>_input" value="" size="<%= this.data.attr('size') %>" data-oid="<%= this.data.attr('oid') %>" <%= (el) -> vis.binds.jqueryui.inputDate(el); %> />
        </div>
    </div>
</script>

<script id="tplJquiInputDatetime" 
        type="text/ejs" 
        class="vis-tpl" 
        data-vis-set="jqui" 
        data-vis-name="ctrl - Input Datetime"
        data-vis-attrs="oid;size/slider,1,50,1;timeOnly/checkbox;hideSeconds/checkbox">
    <div class="vis-widget <%== this.data.attr('class') %>" style="top:0px;left:0px;width:200px;height:40px;" id="<%= this.data.attr("wid") %>">
        <% if (vis.editMode) { %>
			<div class="editmode-helper" />
		<% } %>
        <div class="vis-widget-body">
            <input type="text" name="<%= this.data.attr('wid') %>_input" id="<%= this.data.attr('wid') %>_input" value="" size="<%= this.data.attr('size') %>" data-oid="<%= this.data.attr('oid') %>" <%= (el) -> vis.binds.jqueryui.inputDatetime(el, {timeOnly:data.attr("timeOnly"),showSecond:!data.attr("hideSeconds")}); %> />
        </div>
    </div>
</script>

<script id="tplJquiInputSet" 
        type="text/ejs" class="vis-tpl" 
        data-vis-set="jqui"
        data-vis-name="ctrl - Input + Set-Button" 
        data-vis-attrs="title;buttontext[Text];oid;unit;digits/slider,0,10,1;size/slider,1,50,1">
    <div class="vis-widget <%== this.data.attr('class') %>" style="top:0px;left:0px;width:300px;height:44px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <label for="<%= this.data.attr('wid') %>_input"><%== this.data.attr('title') %></label>
            <input type="text" name="<%= this.data.attr('wid') %>_input" id="<%= this.data.attr('wid') %>_input" value="" size="<%= this.data.attr('size') %>" style="font-size: 1.1em !important; padding-bottom:8px;"/>
            <%== this.data.attr('unit') %>
            <input type="button" data-oid="<%= this.data.attr('oid') %>" name="<%= this.data.attr('wid') %>_set" id="<%= this.data.attr('wid') %>_set" value="<%= this.data.attr('buttontext') %>" <%= (el) -> vis.binds.jqueryui.inputset(el, data.digits); %>/>
        </div>
    </div>
</script>

<script id="tplJquiButtonState" 
        type="text/ejs" 
        class="vis-tpl"
        data-vis-prev='<div id="prev_tplJquiButtonState" style=" position: relative; text-align: initial;padding: 4px; height: 30px "><div style="left: 384px; top: 470px;" class="vis-widget_prev ui-selectee ui-draggable-handle" data-vis-resizable="{"disabled":true, "handles":"e"}"> <div class="vis-widget-prev-body"> <input type="button" value=" Button " data-o data-val="" class="ui-button ui-widget ui-state-default ui-corner-all" role="button"> </div> </div>'
        data-vis-set="jqui"
        data-vis-type="ctrl"
        data-vis-name="Button State"
        data-vis-attrs="oid;html_prepend;html_append;buttontext[Text];value;padding[5]/slider,0,100,1">
    <div class="vis-widget <%== this.data.attr('class') %>" id="<%= this.data.attr('wid') %>" data-vis-resizable='{"disabled":true, "handles":"e"}' >
        <div class="vis-widget-body" >
            <%== this.data.attr("html_prepend") %>
            <input type="button" id="<%= this.data.attr('wid') %>_button" name="<%= this.data.attr('wid') %>_button" value="<%= this.data.attr('buttontext') %>" data-oid="<%= this.data.attr('oid') %>" data-val="<%= this.data.attr('value') %>" <%= (el) -> vis.binds.jqueryui.button(el, data.value); vis.binds.basic.state(el); %> style="padding: <%= this.data.attr('padding') %>px"/>
            <%== this.data.attr("html_append") %>
        </div>
    </div>
</script>

<script id="tplJquiRadio" 
        type="text/ejs" 
        class="vis-tpl"
        data-vis-prev='<div id="prev_tplJquiRadio" style=" position: relative; text-align: initial;padding: 4px;height: 30px"><div style="top: 243px; left: 348px; font-size: 9px;" class="vis-widget_prev ui-selectee ui-selected ui-draggable-handle" data-vis-resizable="{"disabled":true, "handles":""}"> <div class="vis-widget-prev-body"> <div data-o class="ui-buttonset"> <input type="radio" value="0" class="ui-helper-hidden-accessible"><label class="ui-button ui-widget ui-state-default ui-button-text-only ui-corner-left" role="button" aria-pressed="false"><span class="ui-button-text">OFF</span></label> <input type="radio" value="1" class="ui-helper-hidden-accessible"><label class="ui-button ui-widget ui-state-default ui-button-text-only ui-corner-right ui-state-active" role="button" aria-pressed="true"><span class="ui-button-text">ON</span></label> </div> </div> </div>'
        data-vis-set="jqui"
        data-vis-type="ctrl"
        data-vis-name="Radiobuttons on/off"
        data-vis-attrs="off_text[OFF];on_text[ON];oid;padding[5]/slider,0,100,1">
    <div class="vis-widget <%== this.data.attr('class') %>" id="<%= this.data.attr('wid') %>" data-vis-resizable='{"disabled":true, "handles":""}' >
        <div class="vis-widget-body" >
            <div id="<%= this.data.attr('wid') %>_radio" data-oid="<%= this.data.attr('oid') %>" style="display: flex" <%= (el) -> vis.binds.jqueryui.radio(el); %> >
                <input type="radio" id="<%= this.data.attr('wid') %>_radio0" name="<%= this.data.attr('wid') %>_radio" value="0" checked='checked'/><label for="<%= this.data.attr('wid') %>_radio0" style="padding: <%= this.data.attr('padding') %>px"><%= this.data.off_text %></label>
                <input type="radio" id="<%= this.data.attr('wid') %>_radio1" name="<%= this.data.attr('wid') %>_radio" value="1"/><label for="<%= this.data.attr('wid') %>_radio1" style="padding: <%= this.data.attr('padding') %>px"><%= this.data.on_text %></label>
            </div>
        </div>
    </div>
</script>

<script id="tplJquiRadioList" 
        type="text/ejs" 
        class="vis-tpl"
        data-vis-prev='<div id="prev_tplJquiRadioList" style=" position: relative; text-align: initial;padding: 4px "><div style="top: 228px; left: 83px; font-size: 8px;" class="vis-widget_prev ui-selectee ui-selected ui-draggable-handle" data-vis-resizable="{"disabled":true, "handles":""}"> <div class="vis-widget-prev-body"> <div data-o class="ui-buttonset"> <input type="radio" value="0" class="ui-helper-hidden-accessible"><label class="ui-button ui-widget ui-state-default ui-button-text-only ui-corner-left" role="button" aria-pressed="false"><span class="ui-button-text">OFF</span></label> <input type="radio" value="1" class="ui-helper-hidden-accessible"><label class="ui-button ui-widget ui-state-default ui-button-text-only ui-corner-right" role="button" aria-pressed="false"><span class="ui-button-text">AUTO</span></label> </div> </div> </div>'
        data-vis-set="jqui"
        data-vis-type="ctrl"
        data-vis-name="Radiobuttons ValueList"
        data-vis-attrs="oid;values[0§1§2];texts[OFF§ON§AUTO]">
    <div style=" width:250px; height:41px;" class="vis-widget <%== this.data.attr('class') %>" id="<%= this.data.attr('wid') %>" data-vis-resizable='{"disabled":true, "handles":""}' >
        <div class="vis-widget-body" >
            <div id="<%= this.data.attr('wid') %>_radio" data-oid="<%= this.data.attr('oid') %>" style="display: flex" <%= (el) -> setTimeout(function () {vis.binds.jqueryui.radio(el)},100) %> >
                <%
                var values = (data.attr('values') ? data.attr('values').split(';') : []);
                var texts = (data.attr('texts') ? data.attr('texts').split(';'): []);
                var wid = data.attr('wid');
                for (var val in values) {
                %>
                    <input type="radio" id="<%= wid %>_radio<%= val %>" name="<%= wid %>_radio" value="<%= values[val] %>" /><label for="<%= wid %>_radio<%= val %>" style="float: left"><%= texts[val] %></label>
                <%
                }
                %>
            </div>
        </div>
    </div>
</script>

<script id="tplJquiSelectList" 
        type="text/ejs" 
        class="vis-tpl"
        data-vis-prev='<div id="prev_tplJquiSelectList" style=" position: relative; text-align: initial;padding: 4px "><div class="vis-widget_prev ui-selectee ui-draggable-handle" data-vis-resizable="{"disabled":true, "handles":""}" style="left: 336px; top: 323px;"> <div class="vis-widget-prev-body"> <select data-o disabled="" style="display: none;"> <option value="0">OFF</option> <option value="1">ON</option> <option value="2">AUTO</option> </select><button type="button" class="ui-multiselect ui-widget ui-state-default ui-corner-all" aria-haspopup="true" style="width: 86px;"><span class="ui-icon ui-icon-triangle-2-n-s"></span><span>OFF</span></button> </div> </div>'
        data-vis-set="jqui"
        data-vis-type="ctrl"
        data-vis-name="Select ValueList"
        data-vis-attrs="oid;values[0§1§2];texts[OFF§ON§AUTO];height[100]/slider,15,500,1;open/checkbox">
    <div class="vis-widget <%== this.data.attr('class') %>" id="<%= this.data.attr('wid') %>" >
        <% if (false && vis.editMode) { %>
			<div class="editmode-helper" />
		<% } %>
        <div class="vis-widget-body" >
            <select id="<%= this.data.attr('wid') %>_multiselect" data-oid="<%= this.data.attr('oid') %>" <%= (el) -> setTimeout(function (el_) { vis.binds.jqueryui.multiselect(el_, {height: (data.height || 220)}, data.open)}, 250, el); %> >
            <%
				var values = (data.attr('values') ? data.attr('values').split(';') : []);
				var texts  = (data.attr('texts') ? data.attr('texts').split(';'): []);
				for (var val in values) {
					%>
					<option value="<%= values[val] %>"><%= texts[val] %></option>
					<%
				}
            %>
            </select >
        </div>
    </div>
</script>

<script id="tplJquiRadioSteps" 
        type="text/ejs" 
        class="vis-tpl"
        data-vis-prev='<div id="prev_tplJquiRadioSteps" style="zoom: 0.99; position: relative; text-align: initial;padding: 4px "><div class="vis-widget_prev ui-selectee ui-draggable-handle" data-vis-resizable="{"disabled":true, "handles":"e"}" style="left: 85px; top: 258px; font-size: 5px;"> <div class="vis-widget-prev-body"> <div data-o class="ui-buttonset"> <input type="radio" value="0" class="ui-helper-hidden-accessible"><label class="ui-button ui-widget ui-state-default ui-button-text-only ui-corner-left" role="button" aria-pressed="false"><span class="ui-button-text">aus</span></label> <input type="radio" value="0.25" class="ui-helper-hidden-accessible"><label class="ui-button ui-widget ui-state-default ui-button-text-only" role="button" aria-pressed="false"><span class="ui-button-text">25%</span></label> <input type="radio" value="0.5" class="ui-helper-hidden-accessible"><label class="ui-button ui-widget ui-state-default ui-button-text-only" role="button" aria-pressed="false"><span class="ui-button-text">50%</span></label> <input type="radio" value="0.75" class="ui-helper-hidden-accessible"><label class="ui-button ui-widget ui-state-default ui-button-text-only ui-state-active" role="button" aria-pressed="true"><span class="ui-button-text">75%</span></label> <input type="radio" value="1" class="ui-helper-hidden-accessible"><label class="ui-button ui-widget ui-state-default ui-button-text-only ui-corner-right" role="button" aria-pressed="false"><span class="ui-button-text">100%</span></label> </div> </div> </div>'
        data-vis-set="jqui"
        data-vis-type="ctrl"
        data-vis-name="Radiobuttons 25%"
        data-vis-attrs="oid;min;max">
    <div class="vis-widget <%== this.data.attr('class') %>" id="<%= this.data.attr('wid') %>" data-vis-resizable='{"disabled": true, "handles": "e"}' >
        <div class="vis-widget-body" >
            <div id="<%= this.data.attr('wid') %>_radio"  data-oid="<%= this.data.attr('oid') %>" <%= (el) -> vis.binds.jqueryui.radio(el); %> >
                <input type="radio" id="<%= this.data.attr('wid') %>_radio0" name="<%= this.data.attr('wid') %>_radio" value="<%= vis.binds.jqueryui.calcValue(0,    this.data.attr('min'), this.data.attr('max')) %>" checked='checked'/><label for="<%= this.data.attr('wid') %>_radio0">aus</label>
                <input type="radio" id="<%= this.data.attr('wid') %>_radio1" name="<%= this.data.attr('wid') %>_radio" value="<%= vis.binds.jqueryui.calcValue(0.25, this.data.attr('min'), this.data.attr('max')) %>" checked='checked'/><label for="<%= this.data.attr('wid') %>_radio1">25%</label>
                <input type="radio" id="<%= this.data.attr('wid') %>_radio2" name="<%= this.data.attr('wid') %>_radio" value="<%= vis.binds.jqueryui.calcValue(0.5,  this.data.attr('min'), this.data.attr('max')) %>" checked='checked'/><label for="<%= this.data.attr('wid') %>_radio2">50%</label>
                <input type="radio" id="<%= this.data.attr('wid') %>_radio3" name="<%= this.data.attr('wid') %>_radio" value="<%= vis.binds.jqueryui.calcValue(0.75, this.data.attr('min'), this.data.attr('max')) %>" checked='checked'/><label for="<%= this.data.attr('wid') %>_radio3">75%</label>
                <input type="radio" id="<%= this.data.attr('wid') %>_radio4" name="<%= this.data.attr('wid') %>_radio" value="<%= vis.binds.jqueryui.calcValue(1,    this.data.attr('min'), this.data.attr('max')) %>"/><label for="<%= this.data.attr('wid') %>_radio4">100%</label>
            </div>
        </div>
    </div>
</script>

<script id="tplJquiSliderVertical" 
        type="text/ejs" 
        data-vis-attrs="oid;oid-working;min;max;step;inverted/checkbox"
        class="vis-tpl"
        data-vis-set="jqui"
        data-vis-type="ctrl"
        data-vis-name="Slider vertical">
    <div id="<%= this.data.attr("wid") %>" data-vis-resizable='{"minWidth":23, "maxWidth":23}' class="vis-widget" style="width:23px; height:160px; overflow:visible !important;">
        <div class="vis-widget-body <%== this.data.attr('class') %>" style="width: 100%; padding: 4px; ">
            <div class="sliderJQUI" id="<%= this.data.attr("wid") %>_slider" data-oid="<%= this.data.attr('oid') %>" data-oid-working="<%= this.data.attr('oid-working') %>" <%= (el) -> vis.binds.jqueryui.slider(el, {min: parseFloat(data.min), max: parseFloat(data.max), step: parseFloat(data.step), orientation:"vertical", inverted: data.inverted}) %> style="height:100%"/></div>
        </div>
    </div>
</script>

<script id="tplJquiSlider" 
        type="text/ejs" 
        data-vis-attrs="oid;oid-working;min;max;step;inverted/checkbox"
        class="vis-tpl" 
        data-vis-set="jqui"
        data-vis-type="ctrl"
        data-vis-name="Slider horizontal">
    <div id="<%= this.data.attr("wid") %>" data-vis-resizable='{"minHeight":23, "maxHeight":23}' class="vis-widget" style="height:23; width:160px; overflow:visible !important;">
        <div class="vis-widget-body <%== this.data.attr('class') %>" style="padding: 4px;">
            <div class="sliderJQUI" id="<%= this.data.attr("wid") %>_slider" data-oid="<%= this.data.attr('oid') %>" data-oid-working="<%= this.data.attr('oid-working') %>" <%= (el) -> vis.binds.jqueryui.slider(el, {min:parseFloat(data.min),max:parseFloat(data.max),step:parseFloat(data.step), inverted: data.inverted}) %> /></div>
        </div>
    </div>
</script>

<script id="tplIconState" 
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="jqui" 
        data-vis-name="ctrl - Icon State" 
        data-vis-attrs="oid;value;text;src/image;alt;invert_icon/checkbox">
    <%
    var styles = "";
    if (this.data.invert_icon === 'true' || this.data.invert_icon === true) {
        styles = "filter: invert(1); -webkit-filter: invert(1); -moz-filter: invert(1); -o-filter: invert(1); -ms-filter: invert(1);";
    }
    %>
    <div class="vis-widget ui-widget ui-button ui-corner-all ui-state-default <%== this.data.attr('class') %>" style="width: 76px; height: 76px;" id="<%= this.data.attr('wid') %>" data-oid="<%= this.data.attr('oid') %>" data-val="<%= this.data.attr('value') %>" <%= (el) -> vis.binds.basic.state(el); vis.binds.jqueryui.classes(el, null, data.value) %>>
        <div class="vis-widget-body">
            <img <%= this.data.attr('src') ? 'src="' +  this.data.attr('src') + '"' : '' %> style="<%= styles %> vertical-align:middle;height:100%;" alt="<%== this.data.attr('alt') %>" /><%= this.data.attr('text') %>
        </div>
    </div>
</script>

<script id="tplIconStateBool" 
        type="text/ejs" 
        class="vis-tpl"
        data-vis-set="jqui" 
        data-vis-name="ctrl - Icon State / val - Icon Bool" 
        data-vis-attrs="click_id;click_value;oid;false_text;true_text;false_src/image;true_src/image;false_alt;true_alt;invert_icon/checkbox">
    <%
    var styles = "";
    if (this.data.invert_icon === 'true' || this.data.invert_icon === true) {
    styles = "filter: invert(1); -webkit-filter: invert(1); -moz-filter: invert(1); -o-filter: invert(1); -ms-filter: invert(1);";
    }
    %>
    <div class="vis-widget ui-widget ui-button ui-corner-all ui-state-default <%== this.data.attr('class') %>" style="width: 76px; height: 76px;" id="<%= this.data.attr('wid') %>" data-oid="<%= this.data.attr('oid') %>" data-val="<%= this.data.attr('value') %>" <%= (el) -> vis.binds.basic.state(el); vis.binds.jqueryui.classes(el, null, data.value) %>>
        <div class="vis-widget-body">
            <img class="tplImgFalse" <%= this.data.attr('false_src') ? 'src="' +  this.data.attr('false_src') + '"' : '' %> style="<%= styles %> vertical-align:middle;height:100%;" alt="<%== this.data.attr('false_alt') %>" /><%= this.data.attr('false_text') %>
            <img class="tplImgTrue" <%= this.data.attr('true_src') ? 'src="' +  this.data.attr('true_src') + '"' : '' %> style="display: hidden; <%= styles %> vertical-align:middle;height:100%;" alt="<%== this.data.attr('true_alt') %>" /><%= this.data.attr('true_text') %>
            <div <%= (el) -> vis.binds.jqueryui.itoggle(el) %>></div>
        </div>
    </div>
</script>

<script id="tplIconInc" 
        type="text/ejs" 
        class="vis-tpl"
        data-vis-set="jqui"
        data-vis-name="ctrl - Icon Increment" 
        data-vis-attrs="oid;step;minmax;text;src/image;alt;repeat_delay[800];repeat_interval[800];invert_icon/checkbox">
    <%
    var styles = "";
    if (this.data.invert_icon === 'true' || this.data.invert_icon === true) {
        styles = "filter: invert(1); -webkit-filter: invert(1); -moz-filter: invert(1); -o-filter: invert(1); -ms-filter: invert(1);";
    }
    %>
    <div class="vis-widget ui-widget ui-button ui-corner-all ui-state-default <%== this.data.attr('class') %>" style="width: 76px; height: 76px;" id="<%= this.data.attr('wid') %>" data-oid="<%= this.data.attr('oid') %>" data-vis-step="<%= this.data.attr('step') %>" data-val="<%= this.data.attr('active_value') %>" <%= (el) -> vis.binds.basic.increment(el,data.minmax,data.repeat_delay,data.repeat_interval); vis.binds.jqueryui.classes(el, null, data.minmax) %>>
        <div class="vis-widget-body">
            <img <%= this.data.attr('src') ? 'src="' +  this.data.attr('src') + '"' : '' %> style="<%= styles %> vertical-align:middle;height:100%;" alt="<%== this.data.attr('alt') %>" /><%= this.data.attr('text') %>
        </div>
    </div>
</script>



